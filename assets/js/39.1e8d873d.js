(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{545:function(t,s,a){"use strict";a.r(s);var e=a(3),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql锁"}},[t._v("#")]),t._v(" MySQL锁")]),t._v(" "),a("h2",{attrs:{id:"一、分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、分类"}},[t._v("#")]),t._v(" 一、分类")]),t._v(" "),a("p",[t._v("范围分类\n​\t1、全局锁\n​\t2、表级锁\n​\t3、行级锁")]),t._v(" "),a("p",[t._v("使用形式：\n​\t读锁（共享锁S）\n​\t写锁（排他锁X）")]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"二、全局锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、全局锁"}},[t._v("#")]),t._v(" 二、全局锁")]),t._v(" "),a("p",[t._v("加锁之后锁定mysql实例。整个mysql处于只读状态。")]),t._v(" "),a("p",[t._v("加锁的命令：")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("flush tables with read lock;\t\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("解锁：")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("unlock tables;\n或者 \n会话结束\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[a("strong",[t._v("应用场景")]),t._v("：同步数据时加锁。")]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"三、表级锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、表级锁"}},[t._v("#")]),t._v(" 三、表级锁")]),t._v(" "),a("p",[t._v("1、读锁")]),t._v(" "),a("p",[t._v("lock table xxx read；")]),t._v(" "),a("p",[t._v("表处于只读状态，不能修改。共享锁，可以多个会话同时加锁。")]),t._v(" "),a("p",[t._v("2、写锁")]),t._v(" "),a("p",[t._v("lock table xxx write;")]),t._v(" "),a("p",[t._v("加锁的回话对表拥有所有权，只有当前回话可读可写。")]),t._v(" "),a("p",[t._v("解锁：")]),t._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("unlock tables;\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("strong",[t._v("应用场景")]),t._v("：如果使用非InnoDB引擎时，保证数据一致性，可以使用。")]),t._v(" "),a("h2",{attrs:{id:"四、行级锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、行级锁"}},[t._v("#")]),t._v(" 四、行级锁")]),t._v(" "),a("p",[t._v("只有InnoDB引擎支持。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/ichensw/drawing-bed/raw/master/image/s2.png",alt:"s2"}})]),t._v(" "),a("p",[t._v("可以锁定某个数据行。")]),t._v(" "),a("p",[t._v("加锁场景：\n​\tinsert\n​\t\t插入意向锁。记录插入之后没有提交或者回滚时，会锁定这个记录的id。\n​\tupdate（x）\n​\tdelete（x）\n​\tselect .. for update;（x） 排它锁\n​\tselect .. lock in share mode;（s）共享锁")]),t._v(" "),a("p",[a("strong",[t._v("记录锁")]),t._v("：当根据主键等值查询加锁，并且命中一条记录时。")]),t._v(" "),a("p",[a("strong",[t._v("间隙锁")]),t._v("：当根据主键等值查询加锁，没有命中一条记录时。")]),t._v(" "),a("p",[t._v("​\t\t\t\t当事务隔离级别是RR时有间隙锁，如果RC时没有间隙锁。")]),t._v(" "),a("p",[a("strong",[t._v("临键锁")]),t._v("：当根据主键范围查询时（>、<等）并且命中记录时加临建锁，记录锁+间隙锁组成一个临键")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/ichensw/drawing-bed/raw/master/image/s1.png",alt:"s1"}})])])}),[],!1,null,null,null);s.default=r.exports}}]);